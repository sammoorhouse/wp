!function(t){var a={$report_tables:null,$report_selects:null,init:function(){this.$report_tables=jQuery(".bp_ld_report_table"),this.fetch_table_data()},fetch_table_data:function(){this.$report_tables.each(this.fetch_data.bind(this))},fetch_data:function(a,e){var r=this,o=t('[data-report-filter="step"]').val(),n=BP_LD_REPORTS_DATA.table_columns[o],p={columns:this.adjustTableColumns(n,e),processing:!0,serverSide:!0,searching:!1,lengthChange:!1,info:!1,pageLength:BP_LD_REPORTS_DATA.config.perpage,language:{processing:BP_LD_REPORTS_DATA.text.processing,emptyTable:BP_LD_REPORTS_DATA.text.emptyTable,paginate:{first:BP_LD_REPORTS_DATA.text.paginate_first,last:BP_LD_REPORTS_DATA.text.paginate_last,next:BP_LD_REPORTS_DATA.text.paginate_next,previous:BP_LD_REPORTS_DATA.text.paginate_previous}},ajax:{url:BP_LD_REPORTS_DATA.ajax_url,type:"POST",data:function(a){t("[data-report-filter]").each(function(){var e=t(this).data("report-filter");a[e]=t(this).val()}),a.nonce=BP_LD_REPORTS_DATA.nonce,a.action="bp_ld_group_get_reports",a.group=BP_LD_REPORTS_DATA.current_group,a.completed=t(e).data("completed")?1:0,a.display=!0}}};t(e).on("xhr.dt",function(a,e,o){o.data.length>0?t(a.target).closest(".bp_ld_report_table_wrapper").removeClass("no-data hidden").addClass("has-data"):t(a.target).closest(".bp_ld_report_table_wrapper").removeClass("has-data").addClass("no-data hidden"),t(a.target).data("data_length",o.data.length);var n=0;r.$report_tables.each(function(){0==t(this).data("data_length")&&n++}),n==r.$report_tables.length?t(".ld-report-export-csv, .ld-report-no-data").removeClass("has-data").addClass("no-data hidden"):t(".ld-report-export-csv, .ld-report-no-data").removeClass("no-data hidden").addClass("has-data")}).DataTable(p)},adjustTableColumns:function(a,e){var r=t(e).data("completed")?"updated_date":"completion_date",o=[];return t(a).each(function(t,a){a.name!=r&&o.push(a)}),o},prepareExport:function(e){e.preventDefault();var r=t(e.target);if(r.data("exported"))return window.location.href=r.data("export_url"),!1;var o={start:0,length:BP_LD_REPORTS_DATA.config.perpage,nonce:BP_LD_REPORTS_DATA.nonce,action:"bp_ld_group_get_reports",group:BP_LD_REPORTS_DATA.current_group,export:!0};t("[data-report-filter]").each(function(){var a=t(this).data("report-filter");o[a]=t(this).val()}),r.data("export_args",o),a.startExport(r)},startExport:function(a){var e=this,r=a.data("export_args");a.prop("disabled",!0),t.post(BP_LD_REPORTS_DATA.ajax_url,r,function(o){if(a.prop("disabled",!1),o.success){if(o.data.has_more)return r.start=r.start+r.length,r.hash=o.data.hash,a.data("export_args",r),t(".export-indicator").show(),t(".export-indicator .export-current-step").text(o.data.page),t(".export-indicator .export-total-step").text(o.data.total),void e.startExport(a);a.data("exported",!0),a.data("export_url",o.data.url),window.location.href=o.data.url,t(".export-indicator").hide()}else t(".export-indicator").text(BP_LD_REPORTS_DATA.text.export_failed)},"json")}};t.fn.dataTable.ext.classes.sPageButton="button",t(function(){a.init(),t(".ld-report-export-csv").on("click",a.prepareExport)})}(jQuery);